<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Code IDE</title>
    <!-- Emoji-based favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- JSZip library for ZIP file creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div class="ide-container">
        <!-- Header -->
        <header class="ide-header">
            <div class="header-left">
                <h1 class="logo">üöÄ Vibe Code IDE</h1>
                <span class="tagline">Creative coding in the flow</span>
            </div>
            <div class="header-center">
                <div class="project-info">
                    <span id="projectName" onclick="renameProject()" title="Click to rename project">Untitled Project</span>
                    <select id="projectType" onchange="switchProjectType()">
                        <option value="web">Web (HTML/CSS/JS)</option>
                        <option value="react">React</option>
                        <option value="python">Python</option>
                        <option value="nodejs">Node.js</option>
                        <option value="typescript">TypeScript</option>
                        <option value="vue">Vue.js</option>
                        <option value="angular">Angular</option>
                        <option value="svelte">Svelte</option>
                    </select>
                </div>
            </div>
            <div class="header-right">
                <div class="project-controls">
                    <button class="control-btn" onclick="newProject()" title="New Project">
                        üìÑ New
                    </button>
                    <button class="control-btn" onclick="openProject()" title="Open Project">
                        üìÅ Open
                    </button>
                    <button class="control-btn" onclick="saveProject()" title="Save Project">
                        üíæ Save
                    </button>
                    <div class="dropdown">
                        <button class="control-btn dropdown-toggle" id="downloadBtn" title="Download Options">
                            ‚¨áÔ∏è Download
                        </button>
                        <div class="dropdown-menu" id="downloadDropdown">
                            <button onclick="downloadProject()">üìÑ Download as JSON</button>
                            <button onclick="downloadProjectAsZip()">üì¶ Download as ZIP</button>
                        </div>
                    </div>
                    <div class="dropdown">
                        <button class="control-btn dropdown-toggle" id="gitBtn" title="Git Integration">
                            üîó Git
                        </button>
                        <div class="dropdown-menu" id="gitDropdown">
                            <button onclick="connectToGitHub()">üê± Connect GitHub</button>
                            <button onclick="connectToGitLab()">ü¶ä Connect GitLab</button>
                            <button onclick="connectToCodeberg()">üèîÔ∏è Connect Codeberg</button>
                            <hr>
                            <button onclick="manageConnections()" id="manageBtn">‚öôÔ∏è Manage Connections</button>
                            <button onclick="pushToRepo()" id="pushBtn" disabled>üì§ Push to Repo</button>
                            <button onclick="pullFromRepo()" id="pullBtn" disabled>üì• Pull from Repo</button>
                        </div>
                    </div>
                </div>
                <div class="ai-tools">
                    <a href="https://lovable.dev" target="_blank" class="ai-link lovable">
                        <span class="ai-icon">ü§ñ</span>
                        Lovable.dev
                    </a>
                    <a href="https://bolt.new" target="_blank" class="ai-link bolt">
                        <span class="ai-icon">‚ö°</span>
                        Bolt.new
                    </a>
                </div>
                <button class="run-btn" id="runBtn">‚ñ∂ Run</button>
            </div>
        </header>

        <!-- Main IDE Area -->
        <main class="ide-main">
            <!-- Code Panels -->
            <div class="code-panels" id="codePanels">
                <!-- Dynamic panels will be inserted here based on project type -->
            </div>

            <!-- Live Preview -->
            <div class="preview-panel">
                <div class="panel-header">
                    <span class="panel-title">Live Preview</span>
                    <div class="panel-actions">
                        <button class="panel-btn" onclick="refreshPreview()">Refresh</button>
                        <button class="panel-btn" onclick="openInNewTab()">Open in New Tab</button>
                        <button class="panel-btn" onclick="toggleConsole()" id="consoleToggleBtn">Console</button>
                    </div>
                </div>
                <div class="preview-container">
                    <iframe id="preview" class="preview-frame"></iframe>
                    <div id="console" class="console-panel hidden">
                        <div class="console-header">
                            <span>Console Output</span>
                            <button onclick="clearConsole()">Clear</button>
                        </div>
                        <div id="consoleOutput" class="console-output"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="projectModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">New Project</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="projectNameInput">Project Name:</label>
                    <input type="text" id="projectNameInput" placeholder="My Awesome Project">
                </div>
                <div class="form-group">
                    <label for="projectTypeModal">Project Type:</label>
                    <select id="projectTypeModal">
                        <option value="web">Web (HTML/CSS/JS)</option>
                        <option value="react">React</option>
                        <option value="python">Python</option>
                        <option value="nodejs">Node.js</option>
                        <option value="typescript">TypeScript</option>
                        <option value="vue">Vue.js</option>
                        <option value="angular">Angular</option>
                        <option value="svelte">Svelte</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="projectDescription">Description (optional):</label>
                    <textarea id="projectDescription" placeholder="Describe your project..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="createProject()">Create Project</button>
            </div>
        </div>
    </div>

    <div id="gitModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="gitModalTitle">Connect to Repository</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="gitPlatform">Platform:</label>
                    <select id="gitPlatform" onchange="updateGitForm()">
                        <option value="github">GitHub</option>
                        <option value="gitlab">GitLab</option>
                        <option value="codeberg">Codeberg</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="gitToken">Access Token:</label>
                    <input type="password" id="gitToken" placeholder="Your access token">
                    <small class="help-text">Generate a personal access token from your platform settings</small>
                </div>
                <div class="form-group">
                    <label for="gitRepo">Repository URL:</label>
                    <input type="text" id="gitRepo" placeholder="https://github.com/username/repo">
                </div>
                <div class="form-group">
                    <label for="connectionName">Connection Name (optional):</label>
                    <input type="text" id="connectionName" placeholder="My GitHub Repo">
                    <small class="help-text">Give this connection a memorable name</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="connectGitRepo()">Connect</button>
            </div>
        </div>
    </div>

    <div id="connectionsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manage Git Connections</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="connectionsList">
                    <!-- Connections will be populated here -->
                </div>
                <button class="btn btn-primary" onclick="addNewConnection()">Add New Connection</button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <div id="renameModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Rename Project</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newProjectName">New Project Name:</label>
                    <input type="text" id="newProjectName" placeholder="Enter new project name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmRename()">Rename</button>
            </div>
        </div>
    </div>

    <script src="scripts/main.js"></script>
    <script src="scripts/project-manager.js"></script>
    <script src="scripts/git-integration.js"></script>
    <script src="scripts/language-support.js"></script>
    
    <script>
        // Enhanced dropdown functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Vibe Code IDE Loading...');
            
            // Get elements
            const downloadBtn = document.getElementById('downloadBtn');
            const downloadDropdown = document.getElementById('downloadDropdown');
            const gitBtn = document.getElementById('gitBtn');
            const gitDropdown = document.getElementById('gitDropdown');
            
            // Download dropdown handler
            if (downloadBtn && downloadDropdown) {
                downloadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Close git dropdown if open
                    if (gitDropdown) {
                        gitDropdown.classList.remove('show');
                    }
                    
                    // Toggle download dropdown
                    downloadDropdown.classList.toggle('show');
                });
            }
            
            // Git dropdown handler
            if (gitBtn && gitDropdown) {
                gitBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Close download dropdown if open
                    if (downloadDropdown) {
                        downloadDropdown.classList.remove('show');
                    }
                    
                    // Toggle git dropdown
                    gitDropdown.classList.toggle('show');
                });
            }
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                // Check if click is outside download dropdown
                if (downloadDropdown && !downloadBtn.contains(e.target) && !downloadDropdown.contains(e.target)) {
                    downloadDropdown.classList.remove('show');
                }
                
                // Check if click is outside git dropdown
                if (gitDropdown && !gitBtn.contains(e.target) && !gitDropdown.contains(e.target)) {
                    gitDropdown.classList.remove('show');
                }
            });
            
            // Prevent dropdown menu clicks from closing the dropdown
            if (downloadDropdown) {
                downloadDropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            if (gitDropdown) {
                gitDropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });
        
        // Project renaming functionality
        function renameProject() {
            const modal = document.getElementById('renameModal');
            const input = document.getElementById('newProjectName');
            const currentName = document.getElementById('projectName').textContent;
            
            if (modal && input) {
                input.value = currentName;
                modal.classList.remove('hidden');
                modal.classList.add('show');
                setTimeout(() => input.focus(), 100);
            }
        }

        function confirmRename() {
            const input = document.getElementById('newProjectName');
            const projectNameSpan = document.getElementById('projectName');
            
            if (input && projectNameSpan && input.value.trim()) {
                projectNameSpan.textContent = input.value.trim();
                
                // Update project manager if available
                if (window.projectManager) {
                    window.projectManager.currentProject.name = input.value.trim();
                    window.projectManager.saveProject();
                }
                
                closeModal();
                showNotification('Project renamed successfully! ‚úèÔ∏è', 'success');
            }
        }

        // Enhanced console functionality
        function toggleConsole() {
            const console = document.getElementById('console');
            const toggleBtn = document.getElementById('consoleToggleBtn');
            
            if (console) {
                const isHidden = console.classList.contains('hidden');
                
                if (isHidden) {
                    // Show console
                    console.classList.remove('hidden');
                    console.classList.add('show');
                    if (toggleBtn) toggleBtn.textContent = 'Hide Console';
                    
                    // Initialize console if it's being shown for the first time
                    initializeConsole();
                } else {
                    // Hide console
                    console.classList.add('hidden');
                    console.classList.remove('show');
                    if (toggleBtn) toggleBtn.textContent = 'Console';
                }
            }
        }

        function clearConsole() {
            const consoleOutput = document.getElementById('consoleOutput');
            if (consoleOutput) {
                consoleOutput.innerHTML = '';
                showNotification('Console cleared! üßπ', 'info');
            }
        }

        function initializeConsole() {
            const consoleOutput = document.getElementById('consoleOutput');
            if (consoleOutput && consoleOutput.innerHTML.trim() === '') {
                consoleOutput.innerHTML = `
                    <div class="console-welcome">
                        <div class="console-line info">üöÄ Vibe Code IDE Console initialized</div>
                        <div class="console-line info">JavaScript output and errors will appear here</div>
                        <div class="console-line info">Try running some code to see it in action!</div>
                    </div>
                `;
            }
        }

        // Git connections management
        function manageConnections() {
            if (window.gitIntegration) {
                window.gitIntegration.showConnectionsManager();
            }
        }

        function addNewConnection() {
            closeModal();
            // Open git connection modal
            setTimeout(() => {
                if (window.gitIntegration) {
                    window.gitIntegration.connectToGitHub();
                }
            }, 100);
        }

        // Enhanced notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${getNotificationIcon(type)}</span>
                    <span class="notification-message">${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            // Animate in
            setTimeout(() => notification.classList.add('show'), 10);

            // Animate out and remove
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function getNotificationIcon(type) {
            const icons = {
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è',
                'info': '‚ÑπÔ∏è'
            };
            return icons[type] || '‚ÑπÔ∏è';
        }

        // Modal management
        function closeModal() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.classList.remove('show');
                modal.classList.add('hidden');
            });
        }

        // Initialize console enhancement
        document.addEventListener('DOMContentLoaded', function() {
            // Add console styles
            const consoleStyles = document.createElement('style');
            consoleStyles.textContent = `
                .console-panel {
                    transition: all 0.3s ease;
                    max-height: 0;
                    overflow: hidden;
                }
                
                .console-panel.show {
                    max-height: 300px;
                    overflow-y: auto;
                }
                
                .console-welcome {
                    padding: 10px;
                    font-family: 'JetBrains Mono', monospace;
                    font-size: 12px;
                }
                
                .console-line {
                    margin: 5px 0;
                    padding: 2px 0;
                }
                
                .console-line.info {
                    color: #6366f1;
                }
                
                .console-line.error {
                    color: #ef4444;
                }
                
                .console-line.warning {
                    color: #f59e0b;
                }
                
                .notification {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: rgba(0, 0, 0, 0.9);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .notification.show {
                    transform: translateX(0);
                }
                
                .notification.fade-out {
                    opacity: 0;
                    transform: translateX(100%);
                }
                
                .notification.success {
                    background: rgba(34, 197, 94, 0.9);
                }
                
                .notification.error {
                    background: rgba(239, 68, 68, 0.9);
                }
                
                .notification.warning {
                    background: rgba(245, 158, 11, 0.9);
                }
                
                .notification-content {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }
                
                .notification-icon {
                    font-size: 16px;
                }
            `;
            document.head.appendChild(consoleStyles);
        });
    </script>
</body>
</html>