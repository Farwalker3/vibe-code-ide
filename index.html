<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Code IDE</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- JSZip library for ZIP file creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div class="ide-container">
        <!-- Header -->
        <header class="ide-header">
            <div class="header-left">
                <h1 class="logo">üöÄ Vibe Code IDE</h1>
                <span class="tagline">Creative coding in the flow</span>
            </div>
            <div class="header-center">
                <div class="project-info">
                    <span id="projectName">Untitled Project</span>
                    <select id="projectType" onchange="switchProjectType()">
                        <option value="web">Web (HTML/CSS/JS)</option>
                        <option value="react">React</option>
                        <option value="python">Python</option>
                        <option value="nodejs">Node.js</option>
                        <option value="typescript">TypeScript</option>
                        <option value="vue">Vue.js</option>
                        <option value="angular">Angular</option>
                        <option value="svelte">Svelte</option>
                    </select>
                </div>
            </div>
            <div class="header-right">
                <div class="project-controls">
                    <button class="control-btn" onclick="newProject()" title="New Project">
                        üìÑ New
                    </button>
                    <button class="control-btn" onclick="openProject()" title="Open Project">
                        üìÅ Open
                    </button>
                    <button class="control-btn" onclick="saveProject()" title="Save Project">
                        üíæ Save
                    </button>
                    <div class="dropdown">
                        <button class="control-btn dropdown-toggle" onclick="toggleDownloadDropdown()" title="Download Options">
                            ‚¨áÔ∏è Download
                        </button>
                        <div class="dropdown-menu" id="downloadDropdown">
                            <button onclick="downloadProject()">üìÑ Download as JSON</button>
                            <button onclick="downloadProjectAsZip()">üì¶ Download as ZIP</button>
                        </div>
                    </div>
                    <div class="dropdown">
                        <button class="control-btn dropdown-toggle" onclick="toggleGitDropdown()" title="Git Integration">
                            üîó Git
                        </button>
                        <div class="dropdown-menu" id="gitDropdown">
                            <button onclick="connectToGitHub()">üê± Connect GitHub</button>
                            <button onclick="connectToGitLab()">ü¶ä Connect GitLab</button>
                            <button onclick="connectToCodeberg()">üèîÔ∏è Connect Codeberg</button>
                            <hr>
                            <button onclick="pushToRepo()" id="pushBtn" disabled>üì§ Push to Repo</button>
                            <button onclick="pullFromRepo()" id="pullBtn" disabled>üì• Pull from Repo</button>
                        </div>
                    </div>
                </div>
                <div class="ai-tools">
                    <a href="https://lovable.dev" target="_blank" class="ai-link lovable">
                        <span class="ai-icon">ü§ñ</span>
                        Lovable.dev
                    </a>
                    <a href="https://bolt.new" target="_blank" class="ai-link bolt">
                        <span class="ai-icon">‚ö°</span>
                        Bolt.new
                    </a>
                </div>
                <button class="run-btn" id="runBtn">‚ñ∂ Run</button>
            </div>
        </header>

        <!-- Main IDE Area -->
        <main class="ide-main">
            <!-- Code Panels -->
            <div class="code-panels" id="codePanels">
                <!-- Dynamic panels will be inserted here based on project type -->
            </div>

            <!-- Live Preview -->
            <div class="preview-panel">
                <div class="panel-header">
                    <span class="panel-title">Live Preview</span>
                    <div class="panel-actions">
                        <button class="panel-btn" onclick="refreshPreview()">Refresh</button>
                        <button class="panel-btn" onclick="openInNewTab()">Open in New Tab</button>
                        <button class="panel-btn" onclick="toggleConsole()">Console</button>
                    </div>
                </div>
                <div class="preview-container">
                    <iframe id="preview" class="preview-frame"></iframe>
                    <div id="console" class="console-panel hidden">
                        <div class="console-header">
                            <span>Console Output</span>
                            <button onclick="clearConsole()">Clear</button>
                        </div>
                        <div id="consoleOutput" class="console-output"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="projectModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">New Project</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="projectNameInput">Project Name:</label>
                    <input type="text" id="projectNameInput" placeholder="My Awesome Project">
                </div>
                <div class="form-group">
                    <label for="projectTypeModal">Project Type:</label>
                    <select id="projectTypeModal">
                        <option value="web">Web (HTML/CSS/JS)</option>
                        <option value="react">React</option>
                        <option value="python">Python</option>
                        <option value="nodejs">Node.js</option>
                        <option value="typescript">TypeScript</option>
                        <option value="vue">Vue.js</option>
                        <option value="angular">Angular</option>
                        <option value="svelte">Svelte</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="projectDescription">Description (optional):</label>
                    <textarea id="projectDescription" placeholder="Describe your project..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="createProject()">Create Project</button>
            </div>
        </div>
    </div>

    <div id="gitModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="gitModalTitle">Connect to Repository</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="gitPlatform">Platform:</label>
                    <select id="gitPlatform" onchange="updateGitForm()">
                        <option value="github">GitHub</option>
                        <option value="gitlab">GitLab</option>
                        <option value="codeberg">Codeberg</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="gitToken">Access Token:</label>
                    <input type="password" id="gitToken" placeholder="Your access token">
                    <small class="help-text">Generate a personal access token from your platform settings</small>
                </div>
                <div class="form-group">
                    <label for="gitRepo">Repository URL:</label>
                    <input type="text" id="gitRepo" placeholder="https://github.com/username/repo">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="connectGitRepo()">Connect</button>
            </div>
        </div>
    </div>

    <script src="scripts/main.js"></script>
    <script src="scripts/project-manager.js"></script>
    <script src="scripts/git-integration.js"></script>
    <script src="scripts/language-support.js"></script>
    
    <script>
        // Global dropdown functions - defined immediately for onclick handlers
        function toggleDownloadDropdown() {
            console.log('Download dropdown clicked');
            const dropdown = document.getElementById('downloadDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
                console.log('Download dropdown toggled:', dropdown.classList.contains('show'));
            } else {
                console.error('Download dropdown not found');
            }
        }

        function toggleGitDropdown() {
            console.log('Git dropdown clicked');
            const dropdown = document.getElementById('gitDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
                console.log('Git dropdown toggled:', dropdown.classList.contains('show'));
            } else {
                console.error('Git dropdown not found');
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            console.log('Document clicked, target:', e.target);
            
            // Handle download dropdown
            const downloadDropdown = document.getElementById('downloadDropdown');
            const downloadToggle = e.target.closest('[onclick="toggleDownloadDropdown()"]');
            
            if (downloadDropdown && !downloadDropdown.contains(e.target) && !downloadToggle) {
                downloadDropdown.classList.remove('show');
                console.log('Download dropdown closed');
            }

            // Handle git dropdown
            const gitDropdown = document.getElementById('gitDropdown');
            const gitToggle = e.target.closest('[onclick="toggleGitDropdown()"]');
            
            if (gitDropdown && !gitDropdown.contains(e.target) && !gitToggle) {
                gitDropdown.classList.remove('show');
                console.log('Git dropdown closed');
            }
        });

        // Debug function to test if buttons are working
        function debugButtonClick(buttonName) {
            console.log(`${buttonName} button clicked successfully!`);
            alert(`${buttonName} button is working!`);
        }

        // Additional debugging when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, checking elements...');
            
            const gitButton = document.querySelector('[onclick="toggleGitDropdown()"]');
            const downloadButton = document.querySelector('[onclick="toggleDownloadDropdown()"]');
            const gitDropdown = document.getElementById('gitDropdown');
            const downloadDropdown = document.getElementById('downloadDropdown');
            
            console.log('Git button found:', !!gitButton);
            console.log('Download button found:', !!downloadButton);
            console.log('Git dropdown found:', !!gitDropdown);
            console.log('Download dropdown found:', !!downloadDropdown);
            
            if (gitButton) {
                console.log('Git button element:', gitButton);
                // Add event listener as backup
                gitButton.addEventListener('click', function(e) {
                    console.log('Git button clicked via event listener');
                    e.preventDefault();
                    e.stopPropagation();
                    toggleGitDropdown();
                });
            }
            
            if (downloadButton) {
                console.log('Download button element:', downloadButton);
                // Add event listener as backup
                downloadButton.addEventListener('click', function(e) {
                    console.log('Download button clicked via event listener');
                    e.preventDefault();
                    e.stopPropagation();
                    toggleDownloadDropdown();
                });
            }
        });
    </script>
</body>
</html>